{"ast":null,"code":"var _jsxFileName = \"E:\\\\dasty_work_file\\\\web\\\\dastyco\\\\client\\\\src\\\\components\\\\StatusModal.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { GLOBALTYPES } from \"../redux/actions/globalTypes\";\nimport { createPost, updatePost } from \"../redux/actions/postAction\";\nimport Icons from \"./Icons\";\nimport { BiMinus, BiTrash, BiImageAdd } from \"react-icons/bi\";\nimport { imageShowModal, videoShowModal } from \"../utils/mediaShowModal\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst StatusModal = () => {\n  _s();\n\n  const {\n    auth,\n    theme,\n    status,\n    socket\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const [content, setContent] = useState(\"\");\n  const [contentsub, setContentsub] = useState(\"\");\n  const [community, setCommunity] = useState(\"\");\n  const [images, setImages] = useState([]);\n  const [stream, setStream] = useState(false);\n  const videoRef = useRef();\n  const refCanvas = useRef();\n  const [tracks, setTracks] = useState(\"\");\n\n  const handleChangeImages = e => {\n    const files = [...e.target.files];\n    let err = \"\";\n    let newImages = [];\n    files.forEach(file => {\n      if (!file) {\n        return err = \"File does not exist.\";\n      }\n\n      if (file.size > 1024 * 1024 * 5) {\n        return err = \"Image size must be less than 5 mb.\";\n      }\n\n      return newImages.push(file);\n    });\n\n    if (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err\n        }\n      });\n    }\n\n    setImages([...images, ...newImages]);\n  };\n\n  const deleteImages = index => {\n    const newArr = [...images];\n    newArr.splice(index, 1);\n    setImages(newArr);\n  };\n\n  const handleStream = () => {\n    setStream(true);\n\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      navigator.mediaDevices.getUserMedia({\n        video: true\n      }).then(mediaStream => {\n        videoRef.current.srcObject = mediaStream;\n        videoRef.current.play();\n        const track = mediaStream.getTracks();\n        setTracks(track[0]);\n      }).catch(err => console.log(err));\n    }\n  };\n\n  const handleCapture = () => {\n    const width = videoRef.current.clientWidth;\n    const height = videoRef.current.clientHeight;\n    refCanvas.current.setAttribute(\"width\", width);\n    refCanvas.current.setAttribute(\"height\", height);\n    const ctx = refCanvas.current.getContext(\"2d\");\n    ctx.drawImage(videoRef.current, 0, 0, width, height);\n    let URL = refCanvas.current.toDataURL();\n    setImages([...images, {\n      camera: URL\n    }]);\n  };\n\n  const handleStopStream = () => {\n    tracks.stop();\n    setStream(false);\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault(); // if (images.length === 0) {\n    //   return dispatch({\n    //     type: GLOBALTYPES.ALERT,\n    //     payload: { error: \"Add image(s).\" },\n    //   });\n    // }\n\n    if (status.onEdit) {\n      dispatch(updatePost({\n        content,\n        contentsub,\n        community,\n        images,\n        auth,\n        status\n      }));\n    } else {\n      dispatch(createPost({\n        content,\n        contentsub,\n        community,\n        images,\n        auth,\n        socket\n      }));\n    }\n\n    setContent(\"\");\n    setContentsub(\"\");\n    setCommunity(\"\");\n    setImages([]);\n\n    if (tracks) {\n      tracks.stop();\n    }\n\n    dispatch({\n      type: GLOBALTYPES.STATUS,\n      payload: false\n    });\n  };\n\n  useEffect(() => {\n    if (status.onEdit) {\n      setContent(status.content);\n      setContentsub(status.contentsub);\n      setCommunity(status.community);\n      setImages(status.images);\n    }\n  }, [status]);\n  console.log(images);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"status_modal\",\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"status_header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"m-0\",\n          children: \"Create Post\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => dispatch({\n            type: GLOBALTYPES.STATUS,\n            payload: false\n          }),\n          children: /*#__PURE__*/_jsxDEV(BiMinus, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"status_body\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n            onChange: e => setCommunity(e.target.value),\n            value: community,\n            name: \"community\",\n            placeholder: \"Community\",\n            style: {\n              filter: theme ? \"invert(1)\" : \"invert(0)\",\n              color: theme ? \"white\" : \"#111\",\n              background: theme ? \"rgb(0,0,0,0.3)\" : \"\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"status_body-block\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status_body-box\",\n            children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n              onChange: e => setContent(e.target.value),\n              value: content,\n              name: \"content\",\n              placeholder: \"Content title\",\n              style: {\n                filter: theme ? \"invert(1)\" : \"invert(0)\",\n                color: theme ? \"white\" : \"#111\",\n                background: theme ? \"rgb(0,0,0,0.3)\" : \"\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 15\n            }, this), images.map((img, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"file_img\",\n              children: index == 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  children: img.type.match(/video/i) ? videoShowModal(URL.createObjectURL(img, theme)) : imageShowModal(URL.createObjectURL(img, theme))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 168,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    onClick: () => deleteImages(0),\n                    children: /*#__PURE__*/_jsxDEV(BiTrash, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 175,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 174,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 173,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 17\n            }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input_images\",\n              children: stream ? /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"fas fa-camera\",\n                onClick: handleCapture\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"file_upload\",\n                  children: [/*#__PURE__*/_jsxDEV(BiImageAdd, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 190,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                    onChange: handleChangeImages,\n                    type: \"file\",\n                    name: \"file\",\n                    id: \"file\",\n                    multiple: true,\n                    accept: \"image/*,video/*\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 191,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 189,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status_body-box\",\n            children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n              onChange: e => setContentsub(e.target.value),\n              value: contentsub,\n              name: \"contentsub\",\n              placeholder: \"Content title\",\n              style: {\n                filter: theme ? \"invert(1)\" : \"invert(0)\",\n                color: theme ? \"white\" : \"#111\",\n                background: theme ? \"rgb(0,0,0,0.3)\" : \"\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 15\n            }, this), images.map((img, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"file_img\",\n              children: index == 1 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  children: img.type.match(/video/i) ? videoShowModal(URL.createObjectURL(img, theme)) : imageShowModal(URL.createObjectURL(img, theme))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 221,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    onClick: () => deleteImages(1),\n                    children: /*#__PURE__*/_jsxDEV(BiTrash, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 228,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 227,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 226,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 17\n            }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input_images\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"file_upload\",\n                children: [/*#__PURE__*/_jsxDEV(BiImageAdd, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 260,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  onChange: handleChangeImages,\n                  type: \"file\",\n                  name: \"file\",\n                  id: \"file\",\n                  multiple: true,\n                  accept: \"image/*,video/*\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 261,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 259,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"status_footer\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"create-button\",\n          children: \"Post\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 125,\n    columnNumber: 5\n  }, this);\n};\n\n_s(StatusModal, \"aijSEyhat67Mfatk+J31tZu+XB8=\", false, function () {\n  return [useSelector, useDispatch];\n});\n\n_c = StatusModal;\nexport default StatusModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"StatusModal\");","map":{"version":3,"sources":["E:/dasty_work_file/web/dastyco/client/src/components/StatusModal.js"],"names":["React","useState","useRef","useEffect","useDispatch","useSelector","GLOBALTYPES","createPost","updatePost","Icons","BiMinus","BiTrash","BiImageAdd","imageShowModal","videoShowModal","StatusModal","auth","theme","status","socket","state","dispatch","content","setContent","contentsub","setContentsub","community","setCommunity","images","setImages","stream","setStream","videoRef","refCanvas","tracks","setTracks","handleChangeImages","e","files","target","err","newImages","forEach","file","size","push","type","ALERT","payload","error","deleteImages","index","newArr","splice","handleStream","navigator","mediaDevices","getUserMedia","video","then","mediaStream","current","srcObject","play","track","getTracks","catch","console","log","handleCapture","width","clientWidth","height","clientHeight","setAttribute","ctx","getContext","drawImage","URL","toDataURL","camera","handleStopStream","stop","handleSubmit","preventDefault","onEdit","STATUS","value","filter","color","background","map","img","match","createObjectURL"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,MAA1B,EAAkCC,SAAlC,QAAmD,OAAnD;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AACA,SAASC,WAAT,QAA4B,8BAA5B;AACA,SAASC,UAAT,EAAqBC,UAArB,QAAuC,6BAAvC;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAASC,OAAT,EAAkBC,OAAlB,EAA2BC,UAA3B,QAA6C,gBAA7C;AACA,SAASC,cAAT,EAAyBC,cAAzB,QAA+C,yBAA/C;;;;AAEA,MAAMC,WAAW,GAAG,MAAM;AAAA;;AACxB,QAAM;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,KAAR;AAAeC,IAAAA,MAAf;AAAuBC,IAAAA;AAAvB,MAAkCd,WAAW,CAAEe,KAAD,IAAWA,KAAZ,CAAnD;AACA,QAAMC,QAAQ,GAAGjB,WAAW,EAA5B;AAEA,QAAM,CAACkB,OAAD,EAAUC,UAAV,IAAwBtB,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAM,CAACuB,UAAD,EAAaC,aAAb,IAA8BxB,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM,CAACyB,SAAD,EAAYC,YAAZ,IAA4B1B,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAM,CAAC2B,MAAD,EAASC,SAAT,IAAsB5B,QAAQ,CAAC,EAAD,CAApC;AACA,QAAM,CAAC6B,MAAD,EAASC,SAAT,IAAsB9B,QAAQ,CAAC,KAAD,CAApC;AACA,QAAM+B,QAAQ,GAAG9B,MAAM,EAAvB;AACA,QAAM+B,SAAS,GAAG/B,MAAM,EAAxB;AACA,QAAM,CAACgC,MAAD,EAASC,SAAT,IAAsBlC,QAAQ,CAAC,EAAD,CAApC;;AAEA,QAAMmC,kBAAkB,GAAIC,CAAD,IAAO;AAChC,UAAMC,KAAK,GAAG,CAAC,GAAGD,CAAC,CAACE,MAAF,CAASD,KAAb,CAAd;AACA,QAAIE,GAAG,GAAG,EAAV;AACA,QAAIC,SAAS,GAAG,EAAhB;AAEAH,IAAAA,KAAK,CAACI,OAAN,CAAeC,IAAD,IAAU;AACtB,UAAI,CAACA,IAAL,EAAW;AACT,eAAQH,GAAG,GAAG,sBAAd;AACD;;AACD,UAAIG,IAAI,CAACC,IAAL,GAAY,OAAO,IAAP,GAAc,CAA9B,EAAiC;AAC/B,eAAQJ,GAAG,GAAG,oCAAd;AACD;;AACD,aAAOC,SAAS,CAACI,IAAV,CAAeF,IAAf,CAAP;AACD,KARD;;AASA,QAAIH,GAAJ,EAAS;AACPnB,MAAAA,QAAQ,CAAC;AAAEyB,QAAAA,IAAI,EAAExC,WAAW,CAACyC,KAApB;AAA2BC,QAAAA,OAAO,EAAE;AAAEC,UAAAA,KAAK,EAAET;AAAT;AAApC,OAAD,CAAR;AACD;;AACDX,IAAAA,SAAS,CAAC,CAAC,GAAGD,MAAJ,EAAY,GAAGa,SAAf,CAAD,CAAT;AACD,GAlBD;;AAoBA,QAAMS,YAAY,GAAIC,KAAD,IAAW;AAC9B,UAAMC,MAAM,GAAG,CAAC,GAAGxB,MAAJ,CAAf;AACAwB,IAAAA,MAAM,CAACC,MAAP,CAAcF,KAAd,EAAqB,CAArB;AACAtB,IAAAA,SAAS,CAACuB,MAAD,CAAT;AACD,GAJD;;AAMA,QAAME,YAAY,GAAG,MAAM;AACzBvB,IAAAA,SAAS,CAAC,IAAD,CAAT;;AACA,QAAIwB,SAAS,CAACC,YAAV,IAA0BD,SAAS,CAACC,YAAV,CAAuBC,YAArD,EAAmE;AACjEF,MAAAA,SAAS,CAACC,YAAV,CACGC,YADH,CACgB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OADhB,EAEGC,IAFH,CAESC,WAAD,IAAiB;AACrB5B,QAAAA,QAAQ,CAAC6B,OAAT,CAAiBC,SAAjB,GAA6BF,WAA7B;AACA5B,QAAAA,QAAQ,CAAC6B,OAAT,CAAiBE,IAAjB;AACA,cAAMC,KAAK,GAAGJ,WAAW,CAACK,SAAZ,EAAd;AACA9B,QAAAA,SAAS,CAAC6B,KAAK,CAAC,CAAD,CAAN,CAAT;AACD,OAPH,EAQGE,KARH,CAQU1B,GAAD,IAAS2B,OAAO,CAACC,GAAR,CAAY5B,GAAZ,CARlB;AASD;AACF,GAbD;;AAeA,QAAM6B,aAAa,GAAG,MAAM;AAC1B,UAAMC,KAAK,GAAGtC,QAAQ,CAAC6B,OAAT,CAAiBU,WAA/B;AACA,UAAMC,MAAM,GAAGxC,QAAQ,CAAC6B,OAAT,CAAiBY,YAAhC;AAEAxC,IAAAA,SAAS,CAAC4B,OAAV,CAAkBa,YAAlB,CAA+B,OAA/B,EAAwCJ,KAAxC;AACArC,IAAAA,SAAS,CAAC4B,OAAV,CAAkBa,YAAlB,CAA+B,QAA/B,EAAyCF,MAAzC;AAEA,UAAMG,GAAG,GAAG1C,SAAS,CAAC4B,OAAV,CAAkBe,UAAlB,CAA6B,IAA7B,CAAZ;AACAD,IAAAA,GAAG,CAACE,SAAJ,CAAc7C,QAAQ,CAAC6B,OAAvB,EAAgC,CAAhC,EAAmC,CAAnC,EAAsCS,KAAtC,EAA6CE,MAA7C;AAEA,QAAIM,GAAG,GAAG7C,SAAS,CAAC4B,OAAV,CAAkBkB,SAAlB,EAAV;AACAlD,IAAAA,SAAS,CAAC,CAAC,GAAGD,MAAJ,EAAY;AAAEoD,MAAAA,MAAM,EAAEF;AAAV,KAAZ,CAAD,CAAT;AACD,GAZD;;AAcA,QAAMG,gBAAgB,GAAG,MAAM;AAC7B/C,IAAAA,MAAM,CAACgD,IAAP;AACAnD,IAAAA,SAAS,CAAC,KAAD,CAAT;AACD,GAHD;;AAKA,QAAMoD,YAAY,GAAI9C,CAAD,IAAO;AAC1BA,IAAAA,CAAC,CAAC+C,cAAF,GAD0B,CAE1B;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAIlE,MAAM,CAACmE,MAAX,EAAmB;AACjBhE,MAAAA,QAAQ,CACNb,UAAU,CAAC;AAAEc,QAAAA,OAAF;AAAWE,QAAAA,UAAX;AAAuBE,QAAAA,SAAvB;AAAkCE,QAAAA,MAAlC;AAA0CZ,QAAAA,IAA1C;AAAgDE,QAAAA;AAAhD,OAAD,CADJ,CAAR;AAGD,KAJD,MAIO;AACLG,MAAAA,QAAQ,CACNd,UAAU,CAAC;AAAEe,QAAAA,OAAF;AAAWE,QAAAA,UAAX;AAAuBE,QAAAA,SAAvB;AAAkCE,QAAAA,MAAlC;AAA0CZ,QAAAA,IAA1C;AAAgDG,QAAAA;AAAhD,OAAD,CADJ,CAAR;AAGD;;AAEDI,IAAAA,UAAU,CAAC,EAAD,CAAV;AACAE,IAAAA,aAAa,CAAC,EAAD,CAAb;AACAE,IAAAA,YAAY,CAAC,EAAD,CAAZ;AACAE,IAAAA,SAAS,CAAC,EAAD,CAAT;;AACA,QAAIK,MAAJ,EAAY;AACVA,MAAAA,MAAM,CAACgD,IAAP;AACD;;AACD7D,IAAAA,QAAQ,CAAC;AACPyB,MAAAA,IAAI,EAAExC,WAAW,CAACgF,MADX;AAEPtC,MAAAA,OAAO,EAAE;AAFF,KAAD,CAAR;AAID,GA9BD;;AAgCA7C,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIe,MAAM,CAACmE,MAAX,EAAmB;AACjB9D,MAAAA,UAAU,CAACL,MAAM,CAACI,OAAR,CAAV;AACAG,MAAAA,aAAa,CAACP,MAAM,CAACM,UAAR,CAAb;AACAG,MAAAA,YAAY,CAACT,MAAM,CAACQ,SAAR,CAAZ;AACAG,MAAAA,SAAS,CAACX,MAAM,CAACU,MAAR,CAAT;AACD;AACF,GAPQ,EAON,CAACV,MAAD,CAPM,CAAT;AAQAiD,EAAAA,OAAO,CAACC,GAAR,CAAYxC,MAAZ;AAEA,sBACE;AAAK,IAAA,SAAS,EAAC,cAAf;AAAA,2BACE;AAAM,MAAA,QAAQ,EAAEuD,YAAhB;AAAA,8BACE;AAAK,QAAA,SAAS,EAAC,eAAf;AAAA,gCACE;AAAI,UAAA,SAAS,EAAC,KAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AACE,UAAA,OAAO,EAAE,MACP9D,QAAQ,CAAC;AAAEyB,YAAAA,IAAI,EAAExC,WAAW,CAACgF,MAApB;AAA4BtC,YAAAA,OAAO,EAAE;AAArC,WAAD,CAFZ;AAAA,iCAKE,QAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AALF;AAAA;AAAA;AAAA;AAAA,gBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eAWE;AAAK,QAAA,SAAS,EAAC,aAAf;AAAA,gCACE;AAAA,iCACE;AACE,YAAA,QAAQ,EAAGX,CAAD,IAAOV,YAAY,CAACU,CAAC,CAACE,MAAF,CAASgD,KAAV,CAD/B;AAEE,YAAA,KAAK,EAAE7D,SAFT;AAGE,YAAA,IAAI,EAAC,WAHP;AAIE,YAAA,WAAW,EAAC,WAJd;AAKE,YAAA,KAAK,EAAE;AACL8D,cAAAA,MAAM,EAAEvE,KAAK,GAAG,WAAH,GAAiB,WADzB;AAELwE,cAAAA,KAAK,EAAExE,KAAK,GAAG,OAAH,GAAa,MAFpB;AAGLyE,cAAAA,UAAU,EAAEzE,KAAK,GAAG,gBAAH,GAAsB;AAHlC;AALT;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBADF,eAcE;AAAK,UAAA,SAAS,EAAC,mBAAf;AAAA,kCACE;AAAK,YAAA,SAAS,EAAC,iBAAf;AAAA,oCACE;AACE,cAAA,QAAQ,EAAGoB,CAAD,IAAOd,UAAU,CAACc,CAAC,CAACE,MAAF,CAASgD,KAAV,CAD7B;AAEE,cAAA,KAAK,EAAEjE,OAFT;AAGE,cAAA,IAAI,EAAC,SAHP;AAIE,cAAA,WAAW,EAAC,eAJd;AAKE,cAAA,KAAK,EAAE;AACLkE,gBAAAA,MAAM,EAAEvE,KAAK,GAAG,WAAH,GAAiB,WADzB;AAELwE,gBAAAA,KAAK,EAAExE,KAAK,GAAG,OAAH,GAAa,MAFpB;AAGLyE,gBAAAA,UAAU,EAAEzE,KAAK,GAAG,gBAAH,GAAsB;AAHlC;AALT;AAAA;AAAA;AAAA;AAAA,oBADF,EAYGW,MAAM,CAAC+D,GAAP,CAAW,CAACC,GAAD,EAAMzC,KAAN,kBACV;AAAiB,cAAA,SAAS,EAAC,UAA3B;AAAA,wBACGA,KAAK,IAAI,CAAT,gBACC;AAAA,wCACE;AAAA,4BACGyC,GAAG,CAAC9C,IAAJ,CAAS+C,KAAT,CAAe,QAAf,IACG/E,cAAc,CAACgE,GAAG,CAACgB,eAAJ,CAAoBF,GAApB,EAAyB3E,KAAzB,CAAD,CADjB,GAEGJ,cAAc,CAACiE,GAAG,CAACgB,eAAJ,CAAoBF,GAApB,EAAyB3E,KAAzB,CAAD;AAHpB;AAAA;AAAA;AAAA;AAAA,wBADF,eAME;AAAA,yCACE;AAAM,oBAAA,OAAO,EAAE,MAAMiC,YAAY,CAAC,CAAD,CAAjC;AAAA,2CACE,QAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,wBANF;AAAA,8BADD,gBAcC;AAfJ,eAAUC,KAAV;AAAA;AAAA;AAAA;AAAA,oBADD,CAZH,eAgCE;AAAK,cAAA,SAAS,EAAC,cAAf;AAAA,wBACGrB,MAAM,gBACL;AAAG,gBAAA,SAAS,EAAC,eAAb;AAA6B,gBAAA,OAAO,EAAEuC;AAAtC;AAAA;AAAA;AAAA;AAAA,sBADK,gBAGL;AAAA,uCACE;AAAK,kBAAA,SAAS,EAAC,aAAf;AAAA,0CACE,QAAC,UAAD;AAAA;AAAA;AAAA;AAAA,0BADF,eAEE;AACE,oBAAA,QAAQ,EAAEjC,kBADZ;AAEE,oBAAA,IAAI,EAAC,MAFP;AAGE,oBAAA,IAAI,EAAC,MAHP;AAIE,oBAAA,EAAE,EAAC,MAJL;AAKE,oBAAA,QAAQ,MALV;AAME,oBAAA,MAAM,EAAC;AANT;AAAA;AAAA;AAAA;AAAA,0BAFF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAJJ;AAAA;AAAA;AAAA;AAAA,oBAhCF;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAsDE;AAAK,YAAA,SAAS,EAAC,iBAAf;AAAA,oCACE;AACE,cAAA,QAAQ,EAAGC,CAAD,IAAOZ,aAAa,CAACY,CAAC,CAACE,MAAF,CAASgD,KAAV,CADhC;AAEE,cAAA,KAAK,EAAE/D,UAFT;AAGE,cAAA,IAAI,EAAC,YAHP;AAIE,cAAA,WAAW,EAAC,eAJd;AAKE,cAAA,KAAK,EAAE;AACLgE,gBAAAA,MAAM,EAAEvE,KAAK,GAAG,WAAH,GAAiB,WADzB;AAELwE,gBAAAA,KAAK,EAAExE,KAAK,GAAG,OAAH,GAAa,MAFpB;AAGLyE,gBAAAA,UAAU,EAAEzE,KAAK,GAAG,gBAAH,GAAsB;AAHlC;AALT;AAAA;AAAA;AAAA;AAAA,oBADF,EAYGW,MAAM,CAAC+D,GAAP,CAAW,CAACC,GAAD,EAAMzC,KAAN,kBACV;AAAiB,cAAA,SAAS,EAAC,UAA3B;AAAA,wBACGA,KAAK,IAAI,CAAT,gBACC;AAAA,wCACE;AAAA,4BACGyC,GAAG,CAAC9C,IAAJ,CAAS+C,KAAT,CAAe,QAAf,IACG/E,cAAc,CAACgE,GAAG,CAACgB,eAAJ,CAAoBF,GAApB,EAAyB3E,KAAzB,CAAD,CADjB,GAEGJ,cAAc,CAACiE,GAAG,CAACgB,eAAJ,CAAoBF,GAApB,EAAyB3E,KAAzB,CAAD;AAHpB;AAAA;AAAA;AAAA;AAAA,wBADF,eAME;AAAA,yCACE;AAAM,oBAAA,OAAO,EAAE,MAAMiC,YAAY,CAAC,CAAD,CAAjC;AAAA,2CACE,QAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,wBANF;AAAA,8BADD,gBAcC;AAfJ,eAAUC,KAAV;AAAA;AAAA;AAAA;AAAA,oBADD,CAZH,eAqDE;AAAK,cAAA,SAAS,EAAC,cAAf;AAAA,qCACE;AAAK,gBAAA,SAAS,EAAC,aAAf;AAAA,wCACE,QAAC,UAAD;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE;AACE,kBAAA,QAAQ,EAAEf,kBADZ;AAEE,kBAAA,IAAI,EAAC,MAFP;AAGE,kBAAA,IAAI,EAAC,MAHP;AAIE,kBAAA,EAAE,EAAC,MAJL;AAKE,kBAAA,QAAQ,MALV;AAME,kBAAA,MAAM,EAAC;AANT;AAAA;AAAA;AAAA;AAAA,wBAFF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBArDF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAtDF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAdF;AAAA;AAAA;AAAA;AAAA;AAAA,cAXF,eAmNE;AAAK,QAAA,SAAS,EAAC,eAAf;AAAA,+BACE;AAAQ,UAAA,IAAI,EAAC,QAAb;AAAsB,UAAA,SAAS,EAAC,eAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cAnNF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UADF;AA6ND,CAhVD;;GAAMrB,W;UACoCV,W,EACvBD,W;;;KAFbW,W;AAkVN,eAAeA,WAAf","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { GLOBALTYPES } from \"../redux/actions/globalTypes\";\r\nimport { createPost, updatePost } from \"../redux/actions/postAction\";\r\nimport Icons from \"./Icons\";\r\nimport { BiMinus, BiTrash, BiImageAdd } from \"react-icons/bi\";\r\nimport { imageShowModal, videoShowModal } from \"../utils/mediaShowModal\";\r\n\r\nconst StatusModal = () => {\r\n  const { auth, theme, status, socket } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n\r\n  const [content, setContent] = useState(\"\");\r\n  const [contentsub, setContentsub] = useState(\"\");\r\n  const [community, setCommunity] = useState(\"\");\r\n  const [images, setImages] = useState([]);\r\n  const [stream, setStream] = useState(false);\r\n  const videoRef = useRef();\r\n  const refCanvas = useRef();\r\n  const [tracks, setTracks] = useState(\"\");\r\n\r\n  const handleChangeImages = (e) => {\r\n    const files = [...e.target.files];\r\n    let err = \"\";\r\n    let newImages = [];\r\n\r\n    files.forEach((file) => {\r\n      if (!file) {\r\n        return (err = \"File does not exist.\");\r\n      }\r\n      if (file.size > 1024 * 1024 * 5) {\r\n        return (err = \"Image size must be less than 5 mb.\");\r\n      }\r\n      return newImages.push(file);\r\n    });\r\n    if (err) {\r\n      dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err } });\r\n    }\r\n    setImages([...images, ...newImages]);\r\n  };\r\n\r\n  const deleteImages = (index) => {\r\n    const newArr = [...images];\r\n    newArr.splice(index, 1);\r\n    setImages(newArr);\r\n  };\r\n\r\n  const handleStream = () => {\r\n    setStream(true);\r\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n      navigator.mediaDevices\r\n        .getUserMedia({ video: true })\r\n        .then((mediaStream) => {\r\n          videoRef.current.srcObject = mediaStream;\r\n          videoRef.current.play();\r\n          const track = mediaStream.getTracks();\r\n          setTracks(track[0]);\r\n        })\r\n        .catch((err) => console.log(err));\r\n    }\r\n  };\r\n\r\n  const handleCapture = () => {\r\n    const width = videoRef.current.clientWidth;\r\n    const height = videoRef.current.clientHeight;\r\n\r\n    refCanvas.current.setAttribute(\"width\", width);\r\n    refCanvas.current.setAttribute(\"height\", height);\r\n\r\n    const ctx = refCanvas.current.getContext(\"2d\");\r\n    ctx.drawImage(videoRef.current, 0, 0, width, height);\r\n\r\n    let URL = refCanvas.current.toDataURL();\r\n    setImages([...images, { camera: URL }]);\r\n  };\r\n\r\n  const handleStopStream = () => {\r\n    tracks.stop();\r\n    setStream(false);\r\n  };\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    // if (images.length === 0) {\r\n    //   return dispatch({\r\n    //     type: GLOBALTYPES.ALERT,\r\n    //     payload: { error: \"Add image(s).\" },\r\n    //   });\r\n    // }\r\n\r\n    if (status.onEdit) {\r\n      dispatch(\r\n        updatePost({ content, contentsub, community, images, auth, status })\r\n      );\r\n    } else {\r\n      dispatch(\r\n        createPost({ content, contentsub, community, images, auth, socket })\r\n      );\r\n    }\r\n\r\n    setContent(\"\");\r\n    setContentsub(\"\");\r\n    setCommunity(\"\");\r\n    setImages([]);\r\n    if (tracks) {\r\n      tracks.stop();\r\n    }\r\n    dispatch({\r\n      type: GLOBALTYPES.STATUS,\r\n      payload: false,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (status.onEdit) {\r\n      setContent(status.content);\r\n      setContentsub(status.contentsub);\r\n      setCommunity(status.community);\r\n      setImages(status.images);\r\n    }\r\n  }, [status]);\r\n  console.log(images);\r\n\r\n  return (\r\n    <div className=\"status_modal\">\r\n      <form onSubmit={handleSubmit}>\r\n        <div className=\"status_header\">\r\n          <h5 className=\"m-0\">Create Post</h5>\r\n          <span\r\n            onClick={() =>\r\n              dispatch({ type: GLOBALTYPES.STATUS, payload: false })\r\n            }\r\n          >\r\n            <BiMinus />\r\n          </span>\r\n        </div>\r\n        <div className=\"status_body\">\r\n          <div>\r\n            <textarea\r\n              onChange={(e) => setCommunity(e.target.value)}\r\n              value={community}\r\n              name=\"community\"\r\n              placeholder=\"Community\"\r\n              style={{\r\n                filter: theme ? \"invert(1)\" : \"invert(0)\",\r\n                color: theme ? \"white\" : \"#111\",\r\n                background: theme ? \"rgb(0,0,0,0.3)\" : \"\",\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"status_body-block\">\r\n            <div className=\"status_body-box\">\r\n              <textarea\r\n                onChange={(e) => setContent(e.target.value)}\r\n                value={content}\r\n                name=\"content\"\r\n                placeholder=\"Content title\"\r\n                style={{\r\n                  filter: theme ? \"invert(1)\" : \"invert(0)\",\r\n                  color: theme ? \"white\" : \"#111\",\r\n                  background: theme ? \"rgb(0,0,0,0.3)\" : \"\",\r\n                }}\r\n              />\r\n              {images.map((img, index) => (\r\n                <div key={index} className=\"file_img\">\r\n                  {index == 0 ? (\r\n                    <>\r\n                      <div>\r\n                        {img.type.match(/video/i)\r\n                          ? videoShowModal(URL.createObjectURL(img, theme))\r\n                          : imageShowModal(URL.createObjectURL(img, theme))}\r\n                      </div>\r\n                      <div>\r\n                        <span onClick={() => deleteImages(0)}>\r\n                          <BiTrash />\r\n                        </span>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <></>\r\n                  )}\r\n                </div>\r\n              ))}\r\n              <div className=\"input_images\">\r\n                {stream ? (\r\n                  <i className=\"fas fa-camera\" onClick={handleCapture} />\r\n                ) : (\r\n                  <>\r\n                    <div className=\"file_upload\">\r\n                      <BiImageAdd />\r\n                      <input\r\n                        onChange={handleChangeImages}\r\n                        type=\"file\"\r\n                        name=\"file\"\r\n                        id=\"file\"\r\n                        multiple\r\n                        accept=\"image/*,video/*\"\r\n                      />\r\n                      {/* {images ? <a>{images[0].name}</a> : <></>} */}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"status_body-box\">\r\n              <textarea\r\n                onChange={(e) => setContentsub(e.target.value)}\r\n                value={contentsub}\r\n                name=\"contentsub\"\r\n                placeholder=\"Content title\"\r\n                style={{\r\n                  filter: theme ? \"invert(1)\" : \"invert(0)\",\r\n                  color: theme ? \"white\" : \"#111\",\r\n                  background: theme ? \"rgb(0,0,0,0.3)\" : \"\",\r\n                }}\r\n              />\r\n              {images.map((img, index) => (\r\n                <div key={index} className=\"file_img\">\r\n                  {index == 1 ? (\r\n                    <>\r\n                      <div>\r\n                        {img.type.match(/video/i)\r\n                          ? videoShowModal(URL.createObjectURL(img, theme))\r\n                          : imageShowModal(URL.createObjectURL(img, theme))}\r\n                      </div>\r\n                      <div>\r\n                        <span onClick={() => deleteImages(1)}>\r\n                          <BiTrash />\r\n                        </span>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <></>\r\n                  )}\r\n                </div>\r\n              ))}\r\n\r\n              {/* {images.map((img, index) => (\r\n            <div key={index} className=\"file_img\">\r\n              {img.camera ? (\r\n                imageShowModal(img.camera, theme)\r\n              ) : img.url ? (\r\n                <>\r\n                  {img.url.match(/video/i)\r\n                    ? videoShowModal(img.url)\r\n                    : imageShowModal(img.url)}\r\n                </>\r\n              ) : (\r\n                <>\r\n                  {img.type.match(/video/i)\r\n                    ? videoShowModal(URL.createObjectURL(img, theme))\r\n                    : imageShowModal(URL.createObjectURL(img, theme))}\r\n                </>\r\n              )}\r\n              <span onClick={() => deleteImages(index)}>&times;</span>\r\n            </div>\r\n          ))} */}\r\n              <div className=\"input_images\">\r\n                <div className=\"file_upload\">\r\n                  <BiImageAdd />\r\n                  <input\r\n                    onChange={handleChangeImages}\r\n                    type=\"file\"\r\n                    name=\"file\"\r\n                    id=\"file\"\r\n                    multiple\r\n                    accept=\"image/*,video/*\"\r\n                  />\r\n                  {/* {images ? <a>{images[1].name}</a> : <></>} */}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* <div className=\"show_images\">\r\n            {images.map((img, index) => (\r\n              <div key={index} className=\"file_img\">\r\n                {img.camera ? (\r\n                  imageShowModal(img.camera, theme)\r\n                ) : img.url ? (\r\n                  <>\r\n                    {img.url.match(/video/i)\r\n                      ? videoShowModal(img.url)\r\n                      : imageShowModal(img.url)}\r\n                  </>\r\n                ) : img[0] ? (\r\n                  <>yes</>\r\n                ) : img[1] ? (\r\n                  <>no</>\r\n                ) : (\r\n                  <>\r\n                    {img.type.match(/video/i)\r\n                      ? videoShowModal(URL.createObjectURL(img, theme))\r\n                      : imageShowModal(URL.createObjectURL(img, theme))}\r\n                  </>\r\n                )}\r\n                <span onClick={() => deleteImages(index)}>&times;</span>\r\n              </div>\r\n            ))}\r\n          </div> */}\r\n            {/* {stream && (\r\n            <div className=\"stream position-relative\">\r\n              <video\r\n                width=\"100%\"\r\n                height=\"100%\"\r\n                ref={videoRef}\r\n                style={{ filter: theme ? \"invert(1)\" : \"invert(0)\" }}\r\n                autoPlay\r\n                muted\r\n              />\r\n\r\n              <span onClick={handleStopStream}>&times;</span>\r\n              <canvas style={{ display: \"none\" }} ref={refCanvas} />\r\n            </div>\r\n          )} */}\r\n            {/* <div className=\"input_images\">\r\n            {stream ? (\r\n              <i className=\"fas fa-camera\" onClick={handleCapture} />\r\n            ) : (\r\n              <>\r\n                <i className=\"fas fa-camera\" onClick={handleStream} />\r\n                <div className=\"file_upload\">\r\n                  <i className=\"fas fa-image\" />\r\n                  <input\r\n                    onChange={handleChangeImages}\r\n                    type=\"file\"\r\n                    name=\"file\"\r\n                    id=\"file\"\r\n                    multiple\r\n                    accept=\"image/*,video/*\"\r\n                  />\r\n                </div>\r\n              </>\r\n            )}\r\n          </div> */}\r\n          </div>\r\n        </div>\r\n        <div className=\"status_footer\">\r\n          <button type=\"submit\" className=\"create-button\">\r\n            Post\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StatusModal;\r\n"]},"metadata":{},"sourceType":"module"}